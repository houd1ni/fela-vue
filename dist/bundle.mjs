import{when as e,complement as t,isNil as r,replace as s,both as n,isEmpty as o,compose as i,equals as l,type as c,map as a,ifElse as u,identity as f,prop as d,toPairs as h,length as p,last as m,qmergeDeep as g,test as b,split as w,fromPairs as y,reverse as $,curry as x,join as C,forEach as v,filter as S,trim as k,always as N,qmap as j,qfilter as _,all as z,head as O,tail as A,slice as E,mergeShallow as P}from"pepka";import{createRenderer as B,combineRules as q}from"fela";import{renderToMarkup as F,rehydrate as M,render as R}from"fela-dom";import W from"fela-plugin-embedded";import L from"fela-plugin-prefixer";import U from"fela-plugin-fallback-value";import Z from"fela-plugin-unit";const D=Object.freeze({}),G=Object.freeze({f:"function",o:"object",s:"string"}),H=e=>e.replace(/-(\w)/gu,((e,t)=>t.toUpperCase())),I=(()=>{const e=/url\(.*?\)/g,t=/[,:;]/g;return r=>r.replace(e,(e=>e.replace(t,(e=>`\\${e}`))))})(),J=e(t(r),s(/([^\\])\\([^\\])/g,"$1$2")),K=n(t(o),t(r));i(l("Object"),c);const Q=i(l("Window"),c),T=(()=>{try{return Q(window)}catch{return!1}})(),V=a(u(i(l("Function"),c),f,d("default"))),X=(e,t)=>i(a((([e,r])=>((e,t,r)=>r(...e[t]||[]))(t,e,r))),h,V)(e),Y=/((\s+?\/\/.*$)|\/\*(.|[\n\r])*?\*\/)/gm,ee=/[\n\r]{2,}|(?:;\s)/g,te=/(^|\r|\n)+[\t ]+/g,re=/[;\n\r]+/g,se=/(?:(}|{|]|)^[;\n\r ]+)|(?:[;\n\r ]+($|}|{|]))/g,ne=/^([\w-]+)(: *| +)(.*)$/,oe=/(^|\r|\n|;|{)\s*([a-z-]+)[ :][\t ]*?:?[\t ]*?([^;\r\n]+)/g,ie=/^(([\|~\$@>\*\.:&\(\)\^="\-\[\]]+).*[ ,]*)+:?$/,le=/^\.\.\.(\S*)$/,ce=/^@media /,ae=/\s*,\s*/g,ue=/(.*):$/,fe=/[.&]/;class de{s;rules={};__selector__=!0;get complex(){return null!==this.s.className&&null!==this.s.modifier}static isSelector(e){return Boolean(e&&e.__selector__)}serialize(){const{className:e,modifier:t}=this.s;return(e?`.${e}`:"")+(t||"")}findClass(e,t=this){if(t.s.className===e)return t;for(const r in t.rules){const s=t.rules[r];if(de.isSelector(s)){const t=s.findClass(e);if(t)return t}}return null}constructor(e){const t=e.match(/^\.[\w-_]+/);this.s={className:t?t[0].slice(1):null,modifier:t?e.slice(t[0].length)||null:e}}}const he=(e,t=0)=>{const r={};let s,n,o,i,l;for(l in e.rules)s=e.rules[l],de.isSelector(s)?(n=s.complex?s.s.className:s.serialize(),o=0==t&&"."==n[0]?n.slice(1):"."==n[0]?`& ${n}`:n,i=s.complex?{[s.s.modifier]:he(s,t+1)}:he(s,t+1),r[o]?g(r[o],i):r[o]=i):r[l]=s;return r};class pe{path=[];get out(){return he(this.path[0][0])}get depth(){return this.path.length}add(e){const t=m(this.path),r=[];for(const s of e){const e=new de(s);for(const s of t){const t=e.serialize(),n=s.rules[t];r.push(n||e),n||(s.rules[t]=e)}}this.path.push(r)}merge(e,t){if(K(t)&&K(e))for(const r of m(this.path))r.rules[e]=t}findClass(e){for(const t of this.path)for(const r of t){const t=r.findClass(e);if(t)return t}return null}pop(){return this.path.pop()}constructor(){this.path.push([new de("__root")])}}const me=Symbol("Placeholder"),ge=e=>{let t=0;for(const r of e)r!==me&&t++;return t},be=(e,t)=>{const r=e.length,s=e.slice(),n=t.length;let o=n,i=0;for(;o&&i<r;i++)s[i]===me&&(s[i]=t[n-o],o--);for(i=r;o;i++,o--)s[i]=t[n-o];return s},we=(e,t,r)=>{const s=e.length-t.length-ge(r);if(s<1)return e(...be(t,r));{const n=(...s)=>we(e,be(t,r),s);return n.$args_left=s,n}},ye=e=>(...t)=>e.length>ge(t)?we(e,[],t):e(...t),$e=e=>function(t){return t===me?e:e(t)};function xe(e){return function(t,r){const s=t===me,n=arguments.length;if(1===n&&s)throw new Error("Senseless placeholder usage.");return arguments.length>1?s?$e((t=>e(t,r))):e(t,r):r=>e(t,r)}}function Ce(e){return ye(e)}const ve=void 0,Se=1/0,ke=e=>typeof e,Ne=e=>null===e,je={u:"U",b:"B",n:"N",s:"S",f:"F"},_e=e=>{const t=ke(e);return"object"===t?Ne(e)?"Null":e.constructor.name:je[t[0]]+t.slice(1)},ze=xe(((e,t)=>(t.push(e),t))),Oe=Ce(((e,t,r)=>r.reduce(e,t))),Ae=Ce(((e,t,r)=>{for(let s in r)switch(_e(r[s])){case"Array":if(e>1&&"Array"===_e(t[s]))switch(e){case 2:const n=t[s],o=r[s];for(const t in o)n[t]?Ae(e,n[t],o[t]):n[t]=o[t];break;case 3:t[s].push(...r[s])}else t[s]=r[s];break;case"Object":if("Object"===_e(t[s])){Ae(e,t[s],r[s]);break}default:t[s]=r[s]}return t}));Ae(1),Ae(2),Ae(3);const Ee=xe(((e,t)=>{const r=_e(e);if(r===_e(t)&&("Object"===r||"Array"==r)){if(Ne(e)||Ne(t))return e===t;if(e===t)return!0;for(const r of[e,t])for(const s in r)if(!(r===t&&s in e||r===e&&s in t&&Ee(e[s],t[s])))return!1;return!0}return e===t})),Pe=ye(((e,t,r,s)=>e(s)?t(s):r(s))),Be=(...e)=>(...t)=>{let r,s=!0;for(let n=Le(e)-1;n>-1;n--)s?(s=!1,r=e[n](...t)):r=r===me?e[n]():e[n](r);return r},qe=xe(((e,t)=>t[e])),Fe=xe(((e,t)=>{if((e=>"string"===ke(e))(t))return t.includes(e);for(const r of t)if(Ee(r,e))return!0;return!1})),Me=Ce(((e,t,r)=>r.slice(e,(e=>"number"==ke(e))(t)?t:Se))),Re=qe(0);Me(1,Se);const We=e=>Ne(e)||(e=>e===ve)(e),Le=e=>e.length,Ue=e=>()=>e,Ze=xe(((e,t)=>t.split(e))),De=e=>Oe(((e,t)=>Fe(t,e)?e:ze(t,e)),[],e),Ge=Ce(((e,t,r)=>({...r,[e]:t}))),He=xe(((e,t)=>t[e])),Ie=Ce(((e,t,r)=>Pe(Le,(()=>We(r)?e:Be(Pe(We,Ue(e),(r=>Ie(e,Me(1,Se,t),r))),(e=>xe(((t,r)=>e(r,t))))(He)(r),Re)(t)),Ue(r),t)));Ie(ve);const Je=/^(.*?)(8|16|32|64)(Clamped)?Array$/,Ke=(e,t=!1)=>{const r=_e(e);switch(r){case"Null":case"String":case"Number":case"Boolean":case"Symbol":return e;case"Array":return t?[...e]:Te(Be(Ke,((...e)=>e[0])),e);case"Object":if(t)return{...e};const s={};for(let t in e)s[t]=Ke(e[t]);return s;default:return Je.test(r)?e.constructor.from(e):e}},Qe=Ce(((e,t,r)=>Oe(e,Ke(t),r))),Te=xe(((e,t)=>t.map(e))),{floor:Ve}=Math;let Xe,Ye;const et=Be((e=>Qe(((e,t)=>Ge(...t,e)),{},e)),Te(((e,t)=>[e,t])),Ze(""));(e=>{if(!(e=>Be(Ee(Le(e)),Le,De,Ze(""))(e))(e))throw new Error("Not all chars are unique!");Xe=e,Ye=Xe.length,et(Xe)})("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");const tt="\ntop flex grid overflow transform transition-duration max-height 100%\nmargin margin-top margin-left margin-bottom margin-right justify-content\nborder width height left border-radius background bottom position align-items\ncenter bottom absolute relative float right opacity z-index min-width\nmin-height border-top border-bottom border-left border-right filter\nfont-family font-size font-weight none hidden auto display block inline inline-block\npadding padding-top padding-bottom padding-left padding-right text-align\nflex-direction column box-shadow rotate content text-decoration max-width\nfixed color space-between overflow-x overflow-y background-size\n".replace(/\s+/g,",").split(/[, ]/g).filter(Boolean),rt=()=>{let e=0;return()=>`a${(e=>{let t="";for(;e>0;)t=Xe[e%Ye]+t,e=Ve(e/Ye);return t||"0"})(e++)}`},st=e=>{const t=rt(),{compose:r,fromPairs:s,map:n,reverse:o,toPairs:i}=e,l=r(s,n((e=>[e,t()])))(tt);return{dic:l,dicRev:r(s,n(o),i)(l)}};let nt=!1;const ot=e=>nt=e,it=st({compose:i,fromPairs:y,map:a,reverse:$,toPairs:h}),lt=(()=>{const t=ne,r=ie,n=le,o=ae,l=ce,c=ue,f=e((()=>nt),(e=>it.dicRev[e]||e));return(d,h,p)=>{let m;switch(!0){case"{"==h:d.add(p);break;case"}"==h:d.pop();break;case null!==(m=n.exec(h)):const g=d.findClass(m[1]);if(g)for(const e in g.rules)d.merge(e,g.rules[e]);break;case null!==(m=t.exec(h)):d.merge(J(H(f(m[1]))),e(isNaN,J,(e=>{switch(e){case"undefined":case"false":case"":return;case"null":return null;default:return isNaN(+e)?e:+e}})(f(m[3]))));break;case null!==(m=r.exec(h)):p.splice(0),p.push(...i(a(s(c,"$1")),u(b(l),(e=>[e]),w(o)))(h))}}})(),ct=x((([e,t],r)=>{let s,n,o=r.length,i=e.length,l=0,c=[];for(s=0;s<o;s++)switch(r.slice(s,s+i)){case e:s+=i-1,0==l&&(n=s),l++;break;case t:if(s+=i-1,l--,0==l)c.push([n,s]);else if(l<0)throw new Error("fela-vue literal: unbalanced delimeter in functional expression !")}return c})),at=i(C("\n"),a((e=>{const t=[];let r=0;for(let[s,n]of ct(["[","]"],e))t.push(e.slice(r,s),`\${${e.slice(s+1,n).replace(/(\W|^)\$([a-zA-Z_]+)\b/g,"$1$$ps.$2").replace(/(\W|^)@(.+?)\b/g,"$1$t.$2")}}`),r=n+1;return t.push(e.slice(r)),t.join("")}))),ut=e=>t=>{const r=[];let s,n,o,i=0,l=[];for(s of t)if(i>0)switch(s){case"{":i++,l[l.length-1]+=s;break;case"}":if(1==--i){if(e){const e=`($ps, $t) => css\`${at(l)}\``;r.push([o,e])}else{const e=new Function("$t,css,$ps",`return css\`\n                ${at(l)}\n              \``);r.push([o,(t,r)=>e(r,bt,t)])}i=0,l.splice(0)}else l[l.length-1]+=s;break;default:l.push(s)}else n=s.indexOf("=>"),~n?(i=1,o=s.slice(0,n).trim().replace(/^\./,"")):r.push(s);return r},ft=(()=>{const e=["\n","\r",";"],r=t=>e.includes(t),n=Y;return(l,u=!1)=>{const f=new pe,d=[];return i((()=>f.out),v((e=>{if("Array"==c(e))f.merge(e[0],e[1]);else if(e&&lt(f,e,d),f.depth<1)throw new Error("lit-css parse error: unbalanced {} braces !")})),ut(u),S(t(o)),a(k),(h=e,e=>{const t=a(p,h),r=[];let s,n,o=0,i=h.length,l=e.length;for(s=0;s<l;s++)for(n=0;n<i;n++)e.slice(s,s+t[n])===h[n]&&"\\"!==e[s-1]&&(r.push(e.slice(o,s)),s+=t[n]-1,o=s+1);return o!==e.length-1&&r.push(e.slice(o)),r}),s(/(\{|\})/g,((e,t,s,n)=>(r(n[s-1])||(t=";"+t),r(n[s+1])||(t+=";"),t))),I,s(n,""))(l);var h}})(),dt=fe,ht=(e,t)=>e[t]||e[H(t)],pt=(e,t,r,s,n)=>{switch(t||(t=D),typeof r){case G.f:return[r.name,[e=>r(e,n)]];case G.o:return[r.className,[N(r)]];case G.s:const o=((e,t,r,s,n)=>i(j((r=>[r,ht(t,r)||ht(e(),r)||D])),j(m),_((e=>{if(p(e)<2)return!0;const t=m(e);let r,o,i;return z((e=>{if(o="!"===O(e),o&&(e=A(e)),r=s[e],!r)throw new Error(`[fela-vue] Class modifier with name ${e} not found.`);return i=r(t,n),o?!i:i}),E(0,-1,e))})),j(w(dt)),_((e=>""!==e)),w(/[,\s\t]+/g))(r))(e,t,r,s,n),l=[],c=[];for(const[r,i]of o)l.push(r),c.push(...pt(e,t,i,s,n)[1]);return[l.join("_"),c];default:return["",[f]]}},mt=function(e,t){if(T)for(const r in e){const s=e[r],n=[];for(const e in s){const t=s[e];"Object"==c(t)?this.setClasses(t,document.querySelectorAll(r+e)):n.push([e,t])}if(n.length){const e=(0,this.renderClasses)(null,y(n)).split(" ");(t||document.querySelectorAll(r)).forEach((t=>t.classList.add(...e)))}}},gt=e=>(t,...r)=>ft(((e,t)=>e.reduce(((e,r,s)=>e+r+(t.length>s?t[s]:"")),""))(t,r),e),bt=gt(!1),wt=gt(!0),yt={method:"f",defStyles:void 0,modifiers:{},plugins:[],enhancers:[],preset:{unit:[]},ssr:!1};class $t{static devClassNames=!1;renderer;_mixin;renderClasses;styl;get mixin(){return Object.freeze(this._mixin)}get style(){return F(this.renderer)}setClasses=mt;constructor(e={}){const{method:t,ssr:r,preset:s,plugins:n,enhancers:o,...l}=((e,t={})=>i(y,a((([e,r])=>{switch(c(r)){case"Array":return[e,[...r,...t[e]||[]]];case"Object":return[e,{...r,...t[e]||{}}];default:return[e,t[e]||r]}})),h)(e))(yt,e),u={...yt.preset,...s||{}},d=this;if(e.fdef)throw new Error("fela-vue: Change deprecated `fdef` to `defStyles`!");this.renderer=B({...l,enhancers:o,plugins:X([Z,W,L,U,...n],{0:u.unit})});const{renderer:p}=this,m=e.defStyles;let g,b;switch(typeof m){case G.o:[g,b]=[m.key,m.value];break;case G.f:[g,b]=["fdef",m]}T&&(r?M(p):R(p)),this.renderClasses=(t,r,s=D,n)=>{const[o,i]=pt((e=>{let t,r=!1;return()=>r?t:(r=!0,t=e())})((()=>b?b(this):D)),t,r,n?P(e.modifiers,n):e.modifiers,this);return p.renderRule(((e,t,r)=>{if(r&&t&&"anonymous"!==t)return{[t]:(t,r)=>e(t,r)}[t];return e})(q(...i),o,$t.devClassNames),s)||void 0},this.styl=(e,t)=>(r,s,n)=>this.renderClasses(e,r,s,n?P(t,n):t),this._mixin=S(f,{methods:{[t]:function(t,r,s){return d.renderClasses.call(this,this.style,t,r,s?P(e.modifiers,s):"styleMods"in this&&this.styleMods)}},computed:m&&{[g](){return b(this)}}})}}class xt extends $t{static get devClassNames(){return $t.devClassNames}static set devClassNames(e){$t.devClassNames=e}f;fdef;getCSS(){return e=>{const t={style:e,fdef:this.fdef};return(e,r)=>this.f.call(t,e,r)}}getLiteralCSS(){const e=this.getCSS();return(...t)=>e(bt(...t))}constructor(e={}){super(e);const t=this.mixin;this.f=t.methods.f,this.fdef="function"==typeof e.defStyles?t.computed.fdef:e.defStyles&&t.computed[e.defStyles.key]}}let Ct=null;const vt=function(){return{name:"fela-vue-compression",async transform(e){const t=await import("pepka"),{compose:r,take:s}=t;Ct||(Ct=st(t));const n=((e,t)=>{const{compose:r,replace:s,trim:n}=t;return r(s(se,"$2"),s(re,";"),s(ee,"\n"),s(te,"$1"),s(Y,""),s(oe,((t,r,s,o)=>o?r+(s&&o?`${n(e.dic[s]||s)}:${n(e.dic[o]||o)};`:n(s?t.replace(s,e.dic[s]||s):o?t.replace(s,e.dic[o]||o):t)):"")))})(Ct,t);let o=e;try{o=e.replace(/css\`((.|\s)*?)\`/g,r((e=>`css\`${n(e)}\``),s(1)))}catch(e){console.warn(e)}return{code:o,map:null}}}};export{$t as Renderer,xt as SvelteRenderer,wt as __specialcss,bt as css,vt as rollupCSSCompression,ot as setCompression};
