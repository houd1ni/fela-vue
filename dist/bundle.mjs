import{when as e,complement as t,isNil as r,replace as s,both as n,isEmpty as o,compose as c,equals as l,type as i,map as a,ifElse as u,identity as f,prop as h,toPairs as d,length as p,last as m,qmergeDeep as g,fromPairs as b,reverse as w,curry as $,join as y,forEach as C,filter as x,trim as S,always as v}from"pepka";import{createRenderer as N,combineRules as k}from"fela";import{renderToMarkup as j,rehydrate as _,render as O}from"fela-dom";import z from"fela-plugin-embedded";import A from"fela-plugin-prefixer";import E from"fela-plugin-fallback-value";import P from"fela-plugin-unit";const B=Object.freeze({}),q=Object.freeze({f:"function",o:"object",s:"string"}),F=e=>e.replace(/-(\w)/gu,((e,t)=>t.toUpperCase())),R=(()=>{const e=/url\(.*?\)/g,t=/[,:;]/g;return r=>r.replace(e,(e=>e.replace(t,(e=>`\\${e}`))))})(),W=e(t(r),s(/([^\\])\\([^\\])/g,"$1$2")),L=n(t(o),t(r));c(l("Object"),i);const U=c(l("Window"),i),M=(()=>{try{return U(window)}catch{return!1}})(),Z=a(u(c(l("Function"),i),f,h("default"))),D=(e,t)=>c(a((([e,r])=>((e,t,r)=>r(...e[t]||[]))(t,e,r))),d,Z)(e),G=/((\s+?\/\/.*$)|\/\*(.|[\n\r])*?\*\/)/gm,H=/[\n\r]{2,}|(?:;\s)/g,I=/(^|\r|\n)+[\t ]+/g,J=/[;\n\r]+/g,K=/(?:(}|{|]|)^[;\n\r ]+)|(?:[;\n\r ]+($|}|{|]))/g,Q=/^([\w-]+)(: *| +)(.*)$/,T=/(^|\r|\n|;|{)\s*([a-z-]+)[ :][\t ]*?:?[\t ]*?([^;\r\n]+)/g,V=/^(([\|~\$@>\*\.:&\(\)\^="\-\[\]]+).*[ ,]*)+:?$/,X=/^\.\.\.(\S*)$/,Y=/\s*,\s*/g,ee=/(.*):$/;class te{s;rules={};__selector__=!0;get complex(){return null!==this.s.className&&null!==this.s.modifier}static isSelector(e){return Boolean(e&&e.__selector__)}serialize(){const{className:e,modifier:t}=this.s;return(e?`.${e}`:"")+(t||"")}findClass(e,t=this){if(t.s.className===e)return t;for(const r in t.rules){const s=t.rules[r];if(te.isSelector(s)){const t=s.findClass(e);if(t)return t}}return null}constructor(e){const t=e.match(/^\.[\w-_]+/);this.s={className:t?t[0].slice(1):null,modifier:t?e.slice(t[0].length)||null:e}}}const re=(e,t=0)=>{const r={};let s,n,o,c,l;for(l in e.rules)s=e.rules[l],te.isSelector(s)?(n=s.complex?s.s.className:s.serialize(),o=0==t&&"."==n[0]?n.slice(1):"."==n[0]?`& ${n}`:n,c=s.complex?{[s.s.modifier]:re(s,t+1)}:re(s,t+1),r[o]?g(r[o],c):r[o]=c):r[l]=s;return r};class se{path=[];get out(){return re(this.path[0][0])}get depth(){return this.path.length}add(e){const t=m(this.path),r=[];for(const s of e){const e=new te(s);for(const s of t){const t=e.serialize(),n=s.rules[t];r.push(n||e),n||(s.rules[t]=e)}}this.path.push(r)}merge(e,t){if(L(t)&&L(e))for(const r of m(this.path))r.rules[e]=t}findClass(e){for(const t of this.path)for(const r of t){const t=r.findClass(e);if(t)return t}return null}pop(){return this.path.pop()}constructor(){this.path.push([new te("__root")])}}const ne=Symbol("Placeholder"),oe=e=>{let t=0;for(const r of e)r!==ne&&t++;return t},ce=(e,t)=>{const r=e.length,s=e.slice(),n=t.length;let o=n,c=0;for(;o&&c<r;c++)s[c]===ne&&(s[c]=t[n-o],o--);for(c=r;o;c++,o--)s[c]=t[n-o];return s},le=(e,t,r)=>{const s=e.length-t.length-oe(r);if(s<1)return e(...ce(t,r));{const n=(...s)=>le(e,ce(t,r),s);return n.$args_left=s,n}},ie=e=>(...t)=>e.length>oe(t)?le(e,[],t):e(...t),ae=e=>function(t){return t===ne?e:e(t)};function ue(e){return function(t,r){const s=t===ne,n=arguments.length;if(1===n&&s)throw new Error("Senseless placeholder usage.");return arguments.length>1?s?ae((t=>e(t,r))):e(t,r):r=>e(t,r)}}function fe(e){return ie(e)}const he=void 0,de=1/0,pe=e=>typeof e,me=e=>null===e,ge={u:"U",b:"B",n:"N",s:"S",f:"F"},be=e=>{const t=pe(e);return"object"===t?me(e)?"Null":e.constructor.name:ge[t[0]]+t.slice(1)},we=ue(((e,t)=>(t.push(e),t))),$e=fe(((e,t,r)=>r.reduce(e,t))),ye=fe(((e,t,r)=>{for(let s in r)switch(be(r[s])){case"Array":if(e>1&&"Array"===be(t[s]))switch(e){case 2:const n=t[s],o=r[s];for(const t in o)n[t]?ye(e,n[t],o[t]):n[t]=o[t];break;case 3:t[s].push(...r[s])}else t[s]=r[s];break;case"Object":if("Object"===be(t[s])){ye(e,t[s],r[s]);break}default:t[s]=r[s]}return t}));ye(1),ye(2),ye(3);const Ce=ue(((e,t)=>{const r=be(e);if(r===be(t)&&("Object"===r||"Array"==r)){if(me(e)||me(t))return e===t;if(e===t)return!0;for(const r of[e,t])for(const s in r)if(!(r===t&&s in e||r===e&&s in t&&Ce(e[s],t[s])))return!1;return!0}return e===t})),xe=ie(((e,t,r,s)=>e(s)?t(s):r(s))),Se=(...e)=>(...t)=>{let r,s=!0;for(let n=Oe(e)-1;n>-1;n--)s?(s=!1,r=e[n](...t)):r=r===ne?e[n]():e[n](r);return r},ve=ue(((e,t)=>t[e])),Ne=ue(((e,t)=>{if((e=>"string"===pe(e))(t))return t.includes(e);for(const r of t)if(Ce(r,e))return!0;return!1})),ke=fe(((e,t,r)=>r.slice(e,(e=>"number"==pe(e))(t)?t:de))),je=ve(0);ke(1,de);const _e=e=>me(e)||(e=>e===he)(e),Oe=e=>e.length,ze=e=>()=>e,Ae=ue(((e,t)=>t.split(e))),Ee=e=>$e(((e,t)=>Ne(t,e)?e:we(t,e)),[],e),Pe=fe(((e,t,r)=>({...r,[e]:t}))),Be=ue(((e,t)=>t[e])),qe=fe(((e,t,r)=>xe(Oe,(()=>_e(r)?e:Se(xe(_e,ze(e),(r=>qe(e,ke(1,de,t),r))),(e=>ue(((t,r)=>e(r,t))))(Be)(r),je)(t)),ze(r),t)));qe(he);const Fe=/^(.*?)(8|16|32|64)(Clamped)?Array$/,Re=(e,t=!1)=>{const r=be(e);switch(r){case"Null":case"String":case"Number":case"Boolean":case"Symbol":return e;case"Array":return t?[...e]:Le(Se(Re,((...e)=>e[0])),e);case"Object":if(t)return{...e};const s={};for(let t in e)s[t]=Re(e[t]);return s;default:return Fe.test(r)?e.constructor.from(e):e}},We=fe(((e,t,r)=>$e(e,Re(t),r))),Le=ue(((e,t)=>t.map(e))),{floor:Ue}=Math;let Me,Ze;const De=Se((e=>We(((e,t)=>Pe(...t,e)),{},e)),Le(((e,t)=>[e,t])),Ae(""));(e=>{if(!(e=>Se(Ce(Oe(e)),Oe,Ee,Ae(""))(e))(e))throw new Error("Not all chars are unique!");Me=e,Ze=Me.length,De(Me)})("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");const Ge="\ntop flex grid overflow transform transition-duration max-height\nmargin margin-top margin-left margin-bottom margin-right justify-content\nborder width height border-radius background bottom position align-items\ncenter bottom absolute relative float right opacity z-index min-width\nmin-height border-top border-bottom filter fixed left color space-between\nfont-weight font-size none hidden auto display block inline inline-block\npadding padding-top padding-bottom padding-left padding-right text-align\nflex-direction column box-shadow rotate 100%\n".replace(/\s+/g,",").split(/[, ]/g).filter(Boolean),He=()=>{let e=0;return()=>`a${(e=>{let t="";for(;e>0;)t=Me[e%Ze]+t,e=Ue(e/Ze);return t||"0"})(e++)}`},Ie=e=>{const t=He(),{compose:r,fromPairs:s,map:n,reverse:o,toPairs:c}=e,l=r(s,n((e=>[e,t()])))(Ge);return{dic:l,dicRev:r(s,n(o),c)(l)}};let Je=!1;const Ke=e=>Je=e,Qe=Ie({compose:c,fromPairs:b,map:a,reverse:w,toPairs:d}),Te=(()=>{const t=Q,r=V,s=X,n=Y,o=ee,c=e((()=>Je),(e=>Qe.dicRev[e]||e));return(l,i,a)=>{let u;switch(!0){case"{"==i:l.add(a);break;case"}"==i:l.pop();break;case null!==(u=s.exec(i)):const f=l.findClass(u[1]);if(f)for(const e in f.rules)l.merge(e,f.rules[e]);break;case null!==(u=t.exec(i)):l.merge(W(F(c(u[1]))),e(isNaN,W,(e=>{switch(e){case"undefined":case"false":case"":return;case"null":return null;default:return isNaN(+e)?e:+e}})(c(u[3]))));break;case null!==(u=r.exec(i)):a.splice(0),a.push(...i.split(n).map((e=>e.replace(o,"$1"))))}}})(),Ve=$((([e,t],r)=>{let s,n,o=r.length,c=e.length,l=0,i=[];for(s=0;s<o;s++)switch(r.slice(s,s+c)){case e:s+=c-1,0==l&&(n=s),l++;break;case t:if(s+=c-1,l--,0==l)i.push([n,s]);else if(l<0)throw new Error("fela-vue literal: unbalanced delimeter in functional expression !")}return i})),Xe=c(y("\n"),a((e=>{const t=[];let r=0;for(let[s,n]of Ve(["[","]"],e))t.push(e.slice(r,s),`\${${e.slice(s+1,n).replace(/(\W|^)\$([a-zA-Z_]+)\b/g,"$1$$ps.$2").replace(/(\W|^)@(.+?)\b/g,"$1$t.$2")}}`),r=n+1;return t.push(e.slice(r)),t.join("")}))),Ye=e=>t=>{const r=[];let s,n,o,c=0,l=[];for(s of t)if(c>0)switch(s){case"{":c++,l[l.length-1]+=s;break;case"}":if(1==--c){if(e){const e=`($ps, $t) => css\`${Xe(l)}\``;r.push([o,e])}else{const e=new Function("$t,css,$ps",`return css\`\n                ${Xe(l)}\n              \``);r.push([o,(t,r)=>e(r,ot,t)])}c=0,l.splice(0)}else l[l.length-1]+=s;break;default:l.push(s)}else n=s.indexOf("=>"),~n?(c=1,o=s.slice(0,n).trim().replace(/^\./,"")):r.push(s);return r},et=(()=>{const e=["\n","\r",";"],r=t=>e.includes(t),n=G;return(l,u=!1)=>{const f=new se,h=[];return c((()=>f.out),C((e=>{if("Array"==i(e))f.merge(e[0],e[1]);else if(e&&Te(f,e,h),f.depth<1)throw new Error("lit-css parse error: unbalanced {} braces !")})),Ye(u),x(t(o)),a(S),(d=e,e=>{const t=a(p,d),r=[];let s,n,o=0,c=d.length,l=e.length;for(s=0;s<l;s++)for(n=0;n<c;n++)e.slice(s,s+t[n])===d[n]&&"\\"!==e[s-1]&&(r.push(e.slice(o,s)),s+=t[n]-1,o=s+1);return o!==e.length-1&&r.push(e.slice(o)),r}),s(/(\{|\})/g,((e,t,s,n)=>(r(n[s-1])||(t=";"+t),r(n[s+1])||(t+=";"),t))),R,s(n,""))(l);var d}})(),tt=(e,t)=>e[t]||e[F(t)],rt=(e,t,r,s)=>{switch(t||(t=B),typeof r){case q.f:return[r.name,[e=>r(e,s)]];case q.o:return[r.className,[v(r)]];case q.s:const n=((e,t,r)=>r.split(/[,\s\t]+/g).map((r=>[r,tt(t,r)||tt(e(),r)||B])))(e,t,r),o=[],c=[];for(const[r,l]of n)o.push(r),c.push(...rt(e,t,l,s)[1]);return[o.join("_"),c];default:return["",[f]]}},st=function(e,t){if(M)for(const r in e){const s=e[r],n=[];for(const e in s){const t=s[e];"Object"==i(t)?this.setClasses(t,document.querySelectorAll(r+e)):n.push([e,t])}if(n.length){const e=(0,this.renderClasses)(null,b(n)).split(" ");(t||document.querySelectorAll(r)).forEach((t=>t.classList.add(...e)))}}},nt=e=>(t,...r)=>et(((e,t)=>e.reduce(((e,r,s)=>e+r+(t.length>s?t[s]:"")),""))(t,r),e),ot=nt(!1),ct=nt(!0),lt={method:"f",defStyles:void 0,plugins:[],enhancers:[],preset:{unit:[]},ssr:!1};class it{static devClassNames=!1;renderer;_mixin;renderClasses;styl;get mixin(){return Object.freeze(this._mixin)}get style(){return j(this.renderer)}setClasses=st;constructor(e={}){const{method:t,ssr:r,preset:s,plugins:n,enhancers:o,...l}=((e,t={})=>c(b,a((([e,r])=>{switch(i(r)){case"Array":return[e,[...r,...t[e]||[]]];case"Object":return[e,{...r,...t[e]||{}}];default:return[e,t[e]||r]}})),d)(e))(lt,e),u={...lt.preset,...s||{}},h=this;if(e.fdef)throw new Error("fela-vue: Change deprecated `fdef` to `defStyles`!");this.renderer=N({...l,enhancers:o,plugins:D([P,z,A,E,...n],{0:u.unit})});const{renderer:p}=this,m=e.defStyles;let g,w;switch(typeof m){case q.o:[g,w]=[m.key,m.value];break;case q.f:[g,w]=["fdef",m]}M&&(r?_(p):O(p)),this.renderClasses=(e,t,r={})=>{const[s,n]=rt((e=>{let t,r=!1;return()=>r?t:(r=!0,t=e())})((()=>w?w(this):B)),e,t,this);return p.renderRule(((e,t,r)=>{if(r&&t&&"anonymous"!==t)return{[t]:(t,r)=>e(t,r)}[t];return e})(k(...n),s,it.devClassNames),r)||void 0},this.styl=e=>(...t)=>this.renderClasses(e,...t),this._mixin=x(f,{methods:{[t]:function(...e){return h.renderClasses.call(this,this.style,...e)}},computed:m&&{[g](){return w(this)}}})}}class at extends it{static get devClassNames(){return it.devClassNames}static set devClassNames(e){it.devClassNames=e}f;fdef;getCSS(){return e=>{const t={style:e,fdef:this.fdef};return(e,r)=>this.f.call(t,e,r)}}getLiteralCSS(){const e=this.getCSS();return(...t)=>e(ot(...t))}constructor(e={}){super(e);const t=this.mixin;this.f=t.methods.f,this.fdef="function"==typeof e.defStyles?t.computed.fdef:e.defStyles&&t.computed[e.defStyles.key]}}let ut=null;const ft=function(){return{name:"fela-vue-compression",async transform(e){const t=await import("pepka"),{compose:r,take:s}=t;ut||(ut=Ie(t));const n=((e,t)=>{const{compose:r,replace:s,trim:n}=t;return r(s(K,"$2"),s(J,";"),s(H,"\n"),s(I,"$1"),s(G,""),s(T,((t,r,s,o)=>o?r+(s&&o?`${n(e.dic[s]||s)}:${n(e.dic[o]||o)};`:n(s?t.replace(s,e.dic[s]||s):o?t.replace(s,e.dic[o]||o):t)):"")))})(ut,t);let o=e;try{o=e.replace(/css\`((.|\s)*?)\`/g,r((e=>`css\`${n(e)}\``),s(1)))}catch(e){console.warn(e)}return{code:o,map:null}}}};export{it as Renderer,at as SvelteRenderer,ct as __specialcss,ot as css,ft as rollupCSSCompression,Ke as setCompression};
