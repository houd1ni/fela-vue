"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var fela=require("fela"),felaDom=require("fela-dom"),embedded=_interopDefault(require("fela-plugin-embedded")),prefixer=_interopDefault(require("fela-plugin-prefixer")),fallback=_interopDefault(require("fela-plugin-fallback-value")),unit=_interopDefault(require("fela-plugin-unit"));const e=e=>typeof e,r=e=>null===e,t=(e,r,s)=>r.length+s.length<e.length?(...s)=>t(e,[...r,...s],s):e(...r,...s),c=e=>(...r)=>t(e,r,[]),n=c((t,s)=>{if("object"==e(t)&&"object"==e(s)){if(r(t)||r(s))return t===s;for(let e of[t,s])for(let r in e)if(!n(t[r],s[r]))return!1}return t===s}),l=c((e,t,r,s)=>e(s)?t(s):r(s)),u=c((e,t,r)=>l(e,t,j,r)),a=(...e)=>t=>{for(let r=i(e)-1;r>-1;r--)t=e[r](t);return t},s=e=>Array.isArray(e),o=e=>r(e)||(e=>void 0===e)(e),i=e=>e.length,f=e=>()=>e,j=e=>e,b=e=>e.trim(),h=e=>e[e.length-1],y=e=>t=>!e(t),p=e=>Object.entries(e),A=c((e,t,r)=>({...r,[e]:t})),d=t=>{switch(e(t)){case"object":switch(C(t)){case"Null":return t;case"Array":return m(d,t);case"Object":const e={};for(let r in t)e[r]=d(t[r]);return e}default:return t}},w=c((e,t,r)=>r.reduce(e,d(t))),N=e=>w((e,t)=>A(...t,e),{},e),k=c((e,t)=>t.join(e)),m=c((e,t)=>t.map(e)),v=c((e,t)=>t.forEach(e)),x=c((e,t,r)=>t(r)&&e(r)),C=t=>{const n=e(t);return"object"==n?s(t)?"Array":r(t)?"Null":"Object":n[0].toUpperCase()+n.slice(1)},E=e=>{switch(C(e)){case"String":return""==e;case"Array":return 0==i(e);case"Null":return!1;case"Object":return 0==i(Object.keys(e));default:return!1}},S=c((e,t,r)=>r.replace(e,t)),U=c((e,t)=>l(a(n("Array"),C),t=>t.filter(e),a(N,U(([t,r])=>e(r,t)),p))(t)),emptyObject=Object.freeze({}),types=Object.freeze({f:"function",o:"object",s:"string"}),camelify=e=>e.replace(/-(\w)/gu,(e,t)=>t.toUpperCase()),memoize=e=>{let t,r=!1;return()=>r?t:(r=!0,t=e())},splitNonEscaped=e=>t=>{const r=m(i,e),s=[];let n,l,c=0,a=e.length,u=t.length;for(n=0;n<u;n++)for(l=0;l<a;l++)t.slice(n,n+r[l])===e[l]&&"\\"!==t[n-1]&&(s.push(t.slice(c,n)),c=(n+=r[l]-1)+1);return c!==t.length-1&&s.push(t.slice(c)),s},escape=(()=>{const e=/url\(.*?\)/g,t=/[,:;]/g;return r=>r.replace(e,e=>e.replace(t,e=>`\\${e}`))})(),unescape=u(y(o),S(/([^\\])\\([^\\])/g,"$1$2")),valuable=x(y(E),y(o)),join=(e,t)=>e.reduce((e,r,s)=>e+r+(t.length>s?t[s]:""),""),isObject=a(n("Object"),C),deepMerge=(e,t)=>{for(let r in t)isObject(e[r])&&isObject(t[r])?deepMerge(e[r],t[r]):e[r]=t[r];return e},isBrowser=(()=>{try{return isObject(window)}catch{return!1}})(),pickStyle=(e,t)=>e[t]||e[camelify(t)],pickStyles=(e,t,r)=>r.split(/[,\s\t]+/g).map(r=>pickStyle(t,r)||pickStyle(e(),r)||emptyObject),getRules=(e,t,r,s)=>{switch(t||(t=emptyObject),typeof r){case types.f:return[e=>r(e,s)];case types.o:return[f(r)];case types.s:return pickStyles(e,t,r).reduce((r,n)=>(r.push(...getRules(e,t,n,s)),r),[]);default:return[j]}};class Selector{constructor(e){this.rules={};const t=e.match(/^\.[\w-_]+/);this.s={className:t?t[0].slice(1):null,modifier:t?e.slice(t[0].length)||null:e}}get complex(){return null!==this.s.className&&null!==this.s.modifier}serialize(){const{className:e,modifier:t}=this.s;return(e?`.${e}`:"")+(t||"")}}const extractRules=(e,t=0)=>{const r={};let s,n,l,c,i;for(i in e.rules)(s=e.rules[i])instanceof Selector?(n=s.complex?s.s.className:s.serialize(),l=0==t&&"."==n[0]?n.slice(1):"."==n[0]?`& ${n}`:n,c=s.complex?{[s.s.modifier]:extractRules(s,t+1)}:extractRules(s,t+1),r[l]?deepMerge(r[l],c):r[l]=c):r[i]=s;return r};class Levels{constructor(){this.path=[],this.path.push([new Selector("__root")])}get out(){return extractRules(this.path[0][0])}get depth(){return this.path.length}add(e){const t=h(this.path),r=[];for(const s of e){const e=new Selector(s);for(const s of t){const t=e.serialize(),n=s.rules[t];r.push(n||e),n||(s.rules[t]=e)}}this.path.push(r)}merge(e,t){if(valuable(t)&&valuable(e))for(const r of h(this.path))r.rules[e]=t}pop(){return this.path.pop()}}const analyseLine=(()=>{const e=/^([\w-]+)(: *| +)(.*)$/,t=/^(([\|~\$@>\*\.:&\(\)\^="\-\[\]]+).*[ ,]*)+:?$/,r=/\s*,\s*/g,s=/(.*):$/;return(n,l,c)=>{let i;switch(!0){case"{"==l:n.add(c);break;case"}"==l:n.pop();break;case null!=(i=e.exec(l)):n.merge(unescape(camelify(i[1])),u(isNaN,unescape,(e=>{switch(e){case"undefined":case"":return;case"null":return null;default:return isNaN(+e)?e:+e}})(i[3])));break;case null!=(i=t.exec(l)):c.splice(0),c.push(...l.split(r).map(e=>e.replace(s,"$1")))}}})(),errorString="fela-vue literal: unbalanced delimeter in functional expression !",findEntries=c(([e,t],r)=>{let s,n,l=r.length,c=e.length,i=0,a=[];for(s=0;s<l;s++)switch(r.slice(s,s+c)){case e:s+=c-1,0==i&&(n=s),i++;break;case t:if(s+=c-1,0==--i)a.push([n,s]);else if(i<0)throw new Error(errorString)}return a}),injectExpressions=e=>{const t=[];let r=0;for(let[s,n]of findEntries(["[","]"],e))t.push(e.slice(r,s),`\${${e.slice(s+1,n).replace(/(\W|^)\$([a-zA-Z_]+)\b/g,"$1$$ps.$2").replace(/(\W|^)@(.+?)\b/g,"$1$t.$2")}}`),r=n+1;return t.push(e.slice(r)),t.join("")},intoExpression=a(k("\n"),m(injectExpressions)),createFunctions=e=>{const t=[];let r,s,n,l=0,c=[];for(r of e)if(l>0)switch(r){case"{":l++,c[c.length-1]+=r;break;case"}":if(1==--l){const e=new Function("$t,css,$ps",`return css\`\n                ${intoExpression(c)}\n              \``);t.push([n,(t,r)=>e(r,css,t)]),l=0,c.splice(0)}else c[c.length-1]+=r;break;default:c.push(r)}else~(s=r.indexOf("=>"))?(l=1,n=r.slice(0,s).trim().replace(/^\./,"")):t.push(r);return t},parse=(()=>{const e=["\n","\r",";"],t=t=>e.includes(t),r=/(([\s^]+?\/\/.*$)|\/\*(.|[\n\r])*?\*\/)/gm;return s=>{const n=new Levels,l=[];return a(()=>n.out,v(e=>{if("Array"==C(e))n.merge(e[0],e[1]);else if(e&&analyseLine(n,e,l),n.depth<1)throw new Error("lit-css parse error: unbalanced {} braces !")}),createFunctions,U(y(E)),m(b),splitNonEscaped(e),S(/(\{|\})/g,(e,r,s,n)=>(t(n[s-1])||(r=";"+r),t(n[s+1])||(r+=";"),r)),escape,S(r,""))(s)}})(),css=(()=>(e,...t)=>parse(join(e,t)))(),defaultOpts={method:"f",defStyles:void 0,plugins:[],enhancers:[],preset:{unit:[]},ssr:!1};class Renderer{constructor(e={}){const{method:t,ssr:r,preset:s,plugins:n,enhancers:l,...c}={...defaultOpts,...e},i={...defaultOpts.preset,...s||{}};if(e.fdef)throw new Error("fela-vue: Change deprecated `fdef` to `defStyles`!");this.renderer=fela.createRenderer({...c,enhancers:l,plugins:[embedded(),prefixer(),fallback(),unit(...i.unit),...n]});const{renderer:a}=this,u=e.defStyles;let o,p;switch(typeof u){case types.o:[o,p]=[u.key,u.value];break;case types.f:[o,p]=["fdef",u]}isBrowser&&(r?felaDom.rehydrate(a):felaDom.render(a)),this._mixin=U(j,{methods:{[t](e,t={}){return a.renderRule(fela.combineRules(...getRules(memoize(()=>p?p(this):emptyObject),this.style,e,this)),t)||void 0}},computed:u?{[o](){return p(this)}}:""})}get mixin(){return Object.freeze(this._mixin)}get style(){return felaDom.renderToMarkup(this.renderer)}}exports.Renderer=Renderer,exports.css=css;
