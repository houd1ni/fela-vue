"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var fela=require("fela"),felaDom=require("fela-dom"),embedded=_interopDefault(require("fela-plugin-embedded")),prefixer=_interopDefault(require("fela-plugin-prefixer")),fallback=_interopDefault(require("fela-plugin-fallback-value")),unit=_interopDefault(require("fela-plugin-unit")),ramda=require("ramda"),C=function(e,r){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)};function _(e,r){function t(){this.constructor=e}C(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}var S=function(){return(S=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e}).apply(this,arguments)};function x(e,r,t,n){return new(t||(t=Promise))((function(a,s){function o(e){try{i(n.next(e))}catch(e){s(e)}}function l(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){e.done?a(e.value):new t((function(r){r(e.value)})).then(o,l)}i((n=n.apply(e,r||[])).next())}))}function A(e,r){var t,n,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function l(s){return function(l){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=r.call(e,o)}catch(e){s=[6,e],n=0}finally{t=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function T(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function q(e){return function r(t){return 0===arguments.length||T(t)?r:e.apply(this,arguments)}}function E(e,r){return Object.prototype.hasOwnProperty.call(r,e)}var k,M=q((function(e){var r=[];for(var t in e)E(t,e)&&(r[r.length]=[t,e[t]]);return r})),N=ramda.curry((function(e,r){for(var t,n=null,a=null,s=0;s<r.length;s++)t=r[s],e.includes(t)?n&&(a=s):(null==n&&(n=s),a=null);return r.slice(n||0,a||r.length)})),W=ramda.compose(ramda.replace(/&/g,"\\&"),String),R=ramda.curry((function(e,r){var t=r.search(e);return~t?[r.slice(0,t),r.slice(t+1)]:[r]})),U=ramda.compose((function(e){var r=e[0],t=r[0],n=r[1],a=e.slice(1);return{name:t,value:n,attrs:ramda.equals(a,[null])?{}:ramda.fromPairs(a)}}),ramda.map(ramda.compose((function(e){var r=e[0],t=e[1];return r?[r,!t||decodeURIComponent(t)]:null}),R(/=/))),ramda.split(/; ?/g)),F=ramda.compose(ramda.join("; "),ramda.filter(ramda.compose(ramda.not,ramda.equals("Null"),ramda.type)),ramda.map((function(e){var r=e[0],t=e[1];return null===t?null:!0===t?r:r+"="+t})),(function(e){var r=e.name,t=e.value,n=e.attrs;return[[r,t]].concat(M(n))})),H=N("/"),z=ramda.curry((function(e,r){return S({},r,{headers:S({},r.headers,e)})})),B=(k=function(e,r,t){return x(null,void 0,void 0,(function(){return A(this,(function(n){switch(n.label){case 0:return t<r.length?[4,e(r[t])]:[3,3];case 1:return n.sent(),[4,k(e,r,++t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},ramda.curry((function(e,r){return k(e,r,0)}))),D=ramda.curry((function(e,r){return Promise.all(r.map(e))})),Q=ramda.tap(ramda.bind(console.log,console)),V=ramda.compose(ramda.pickBy,ramda.unary,ramda.complement)(ramda.isEmpty),Y=ramda.curry((function(e,r){return ramda.compose(ramda.fromPairs,ramda.filter(ramda.complement(ramda.isNil)),ramda.map((function(r){var t=r[0],n=r[1];return null===e[t]?null:[e[t]||t,n]})),ramda.toPairs)(r)})),ot=function(){function e(e){this.pattern=/never/,this.name="Fetch",this.response=e}return Object.defineProperty(e.prototype,"type",{get:function(){return this.name.toLowerCase()},enumerable:!0,configurable:!0}),e.prototype.is=function(e){return this.pattern.test(String(e))},e.prototype.try=function(){var e=this.response;if(this.is(e.status))throw new Error("HTTP "+this.name+" error: status is "+e.status)},e}(),it=function(e){function r(r){var t=e.call(this,r)||this;return t.pattern=/4\d[13]/,t.name="Access",t.try(),t}return _(r,e),r}(ot),ut=function(e){function r(r){var t=e.call(this,r)||this;return t.pattern=/5\d\d/,t.name="Server",t.try(),t}return _(r,e),r}(ot);const emptyObject=Object.freeze({}),types=Object.freeze({f:"function",o:"object",s:"string"}),camelify=e=>e.replace(/-(\w)/gu,(e,r)=>r.toUpperCase()),memoize=e=>{let r,t=!1;return()=>t?r:(t=!0,r=e())},splitNonEscaped=e=>r=>{const t=ramda.map(ramda.length,e),n=[];let a,s,o=0,l=e.length,i=r.length;for(a=0;a<i;a++)for(s=0;s<l;s++)r.slice(a,a+t[s])===e[s]&&"\\"!==r[a-1]&&(n.push(r.slice(o,a)),o=(a+=t[s]-1)+1);return o!==r.length-1&&n.push(r.slice(o)),n},escape=(()=>{const e=/url\(.*?\)/g,r=/[,:;]/g;return t=>t.replace(e,e=>e.replace(r,e=>`\\${e}`))})(),unescape=ramda.when(ramda.complement(ramda.isNil),ramda.replace(/([^\\])\\([^\\])/g,"$1$2")),valuable=ramda.both(ramda.complement(ramda.isEmpty),ramda.complement(ramda.isNil)),join=(e,r)=>e.reduce((e,t,n)=>e+t+(r.length>n?r[n]:""),""),isObject=ramda.compose(ramda.equals("Object"),ramda.type),deepMerge=(e,r)=>{for(let t in r)isObject(e[t])&&isObject(r[t])?deepMerge(e[t],r[t]):e[t]=r[t];return e},isBrowser=(()=>{try{return isObject(window)}catch{return!1}})(),pickStyle=(e,r)=>e[r]||e[camelify(r)],pickStyles=(e,r,t)=>t.split(/[,\s\t]+/g).map(t=>pickStyle(r,t)||pickStyle(e(),t)||emptyObject),getRules=(e,r,t,n)=>{switch(r||(r=emptyObject),typeof t){case types.f:return[e=>t(e,n)];case types.o:return[ramda.always(t)];case types.s:return pickStyles(e,r,t).reduce((t,a)=>(t.push(...getRules(e,r,a,n)),t),[]);default:return[ramda.identity]}};class Selector{constructor(e){this.rules={};const r=e.match(/^\.[\w-_]+/);this.s={className:r?r[0].slice(1):null,modifier:r?e.slice(r[0].length)||null:e}}get complex(){return null!==this.s.className&&null!==this.s.modifier}serialize(){const{className:e,modifier:r}=this.s;return(e?`.${e}`:"")+(r||"")}}const extractRules=(e,r=0)=>{const t={};let n,a,s,o,l;for(l in e.rules)(n=e.rules[l])instanceof Selector?(a=n.complex?n.s.className:n.serialize(),s=0==r&&"."==a[0]?a.slice(1):"."==a[0]?`& ${a}`:a,o=n.complex?{[n.s.modifier]:extractRules(n,r+1)}:extractRules(n,r+1),t[s]?deepMerge(t[s],o):t[s]=o):t[l]=n;return t};class Levels{constructor(){this.path=[],this.path.push([new Selector("__root")])}get out(){return extractRules(this.path[0][0])}get depth(){return this.path.length}add(e){const r=ramda.last(this.path),t=[];for(const n of e){const e=new Selector(n);for(const n of r){const r=e.serialize(),a=n.rules[r];t.push(a||e),a||(n.rules[r]=e)}}this.path.push(t)}merge(e,r){if(valuable(r)&&valuable(e))for(const t of ramda.last(this.path))t.rules[e]=r}pop(){return this.path.pop()}}const analyseLine=(()=>{const e=/^([\w-]+)(: *| +)(.*)$/,r=/^(([\|~\$@>\*\.:&\(\)\^="\-\[\]]+).*[ ,]*)+:?$/,t=/\s*,\s*/g,n=/(.*):$/;return(a,s,o)=>{let l;switch(!0){case"{"==s:a.add(o);break;case"}"==s:a.pop();break;case null!=(l=e.exec(s)):a.merge(unescape(camelify(l[1])),ramda.when(isNaN,unescape,(e=>{switch(e){case"undefined":case"":return;case"null":return null;default:return isNaN(+e)?e:+e}})(l[3])));break;case null!=(l=r.exec(s)):o.splice(0),o.push(...s.split(t).map(e=>e.replace(n,"$1")))}}})(),errorString="fela-vue literal: unbalanced delimeter in functional expression !",findEntries=ramda.curry(([e,r],t)=>{let n,a,s=t.length,o=e.length,l=0,i=[];for(n=0;n<s;n++)switch(t.slice(n,n+o)){case e:n+=o-1,0==l&&(a=n),l++;break;case r:if(n+=o-1,0==--l)i.push([a,n]);else if(l<0)throw new Error(errorString)}return i}),injectExpressions=e=>{const r=[];let t=0;for(let[n,a]of findEntries(["[","]"],e))r.push(e.slice(t,n),`\${${e.slice(n+1,a).replace(/(\W|^)\$([a-zA-Z_]+)\b/g,"$1$$ps.$2").replace(/(\W|^)@(.+?)\b/g,"$1$t.$2")}}`),t=a+1;return r.push(e.slice(t)),r.join("")},intoExpression=ramda.compose(ramda.join("\n"),ramda.map(injectExpressions)),createFunctions=e=>{const r=[];let t,n,a,s=0,o=[];for(t of e)if(s>0)switch(t){case"{":s++,o[o.length-1]+=t;break;case"}":if(1==--s){const e=new Function("$t,css,$ps",`return css\`\n                ${intoExpression(o)}\n              \``);r.push([a,(r,t)=>e(t,css,r)]),s=0,o.splice(0)}else o[o.length-1]+=t;break;default:o.push(t)}else~(n=t.indexOf("=>"))?(s=1,a=t.slice(0,n).trim().replace(/^\./,"")):r.push(t);return r},parse=(()=>{const e=["\n","\r",";"],r=r=>e.includes(r),t=/(([\s^]+?\/\/.*$)|\/\*(.|[\n\r])*?\*\/)/gm;return n=>{const a=new Levels,s=[];return ramda.compose(()=>a.out,ramda.forEach(e=>{if("Array"==ramda.type(e))a.merge(e[0],e[1]);else if(e&&analyseLine(a,e,s),a.depth<1)throw new Error("lit-css parse error: unbalanced {} braces !")}),createFunctions,ramda.filter(ramda.complement(ramda.isEmpty)),ramda.map(ramda.trim),splitNonEscaped(e),ramda.replace(/(\{|\})/g,(e,t,n,a)=>(r(a[n-1])||(t=";"+t),r(a[n+1])||(t+=";"),t)),escape,ramda.replace(t,""))(n)}})(),css=(()=>(e,...r)=>parse(join(e,r)))(),defaultOpts={method:"f",defStyles:void 0,plugins:[],enhancers:[],preset:{unit:[]},ssr:!1};class Renderer{constructor(e={}){const{method:r,ssr:t,preset:n,plugins:a,enhancers:s,...o}={...defaultOpts,...e},l={...defaultOpts.preset,...n||{}};if(e.fdef)throw new Error("fela-vue: Change deprecated `fdef` to `defStyles`!");this.renderer=fela.createRenderer({...o,enhancers:s,plugins:[embedded(),prefixer(),fallback(),unit(...l.unit),...a]});const{renderer:i}=this,c=e.defStyles;let u,p;switch(typeof c){case types.o:[u,p]=[c.key,c.value];break;case types.f:[u,p]=["fdef",c]}isBrowser&&(t?felaDom.rehydrate(i):felaDom.render(i)),this._mixin=V({methods:{[r](e,r={}){return i.renderRule(fela.combineRules(...getRules(memoize(()=>p?p(this):emptyObject),this.style,e,this)),r)||void 0}},computed:c?{[u](){return p(this)}}:""})}get mixin(){return Object.freeze(this._mixin)}get style(){return felaDom.renderToMarkup(this.renderer)}}exports.Renderer=Renderer,exports.css=css;
